"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdatedrawio_test"]("main",{

/***/ "./ontopanelSource/entityFinder_version1/scripts/login-system.js":
/*!***********************************************************************!*\
  !*** ./ontopanelSource/entityFinder_version1/scripts/login-system.js ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _onto_tree_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./onto-tree.js */ \"./ontopanelSource/entityFinder_version1/scripts/onto-tree.js\");\n/* harmony import */ var _store_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./store.js */ \"./ontopanelSource/entityFinder_version1/scripts/store.js\");\n/* harmony import */ var _onto_button__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./onto-button */ \"./ontopanelSource/entityFinder_version1/scripts/onto-button.js\");\n/* harmony import */ var _html_login_system_html__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../html/login-system.html */ \"./ontopanelSource/entityFinder_version1/html/login-system.html\");\n/* harmony import */ var _vars_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../vars.js */ \"./ontopanelSource/vars.js\");\n\r\n\r\n\r\n\r\n\r\n\r\nclass SignForm {\r\n  constructor(app) {\r\n    this.app = app;\r\n    this.init();\r\n  }\r\n  init = () => {\r\n    let loginSystemHtml = document.createElement(\"div\");\r\n    loginSystemHtml.innerHTML = _html_login_system_html__WEBPACK_IMPORTED_MODULE_3__[\"default\"];\r\n    this.app.appendChild(loginSystemHtml);\r\n\r\n    // close box and reset forms\r\n\r\n    let closeBox = loginSystemHtml.querySelectorAll(\".box-close-span\");\r\n    closeBox.forEach((elem) => {\r\n      elem.onclick = () => {\r\n        let parent = elem.parentNode.parentNode;\r\n        parent.style.display = \"none\";\r\n        let forms = parent.querySelectorAll(\"form\");\r\n        forms.forEach((form) => {\r\n          form.querySelector(\".box-info\").innerText = \"\";\r\n          form.reset();\r\n        });\r\n      };\r\n    });\r\n\r\n    this.signLoginBox = loginSystemHtml.querySelector(\r\n      \"#entityfinderold-sign-box\"\r\n    );\r\n    this.signLoginBox.style.display = \"none\";\r\n\r\n    this.resetPasswordBox = loginSystemHtml.querySelector(\r\n      \"#entityfinderold-reset-password-box\"\r\n    );\r\n\r\n    this.resetPasswordBox.style.display = \"none\";\r\n\r\n    // login box\r\n    // automatically login in\r\n    let loginUser = localStorage.getItem(\"loginUser\");\r\n    if (loginUser) {\r\n      loginUser = JSON.parse(loginUser);\r\n      this.downloadOnto(loginUser.token, loginUser.email);\r\n    }\r\n  };\r\n\r\n  signUp = () => {\r\n    this.signLoginBox.style.display = \"block\";\r\n    let signUpForm = this.signLoginBox.querySelector(\r\n      \"#entityfinderold-signup-form\"\r\n    );\r\n    let loginForm = this.signLoginBox.querySelector(\r\n      \"#entityfinderold-login-form\"\r\n    );\r\n\r\n    signUpForm.style.display = \"block\";\r\n    loginForm.style.display = \"none\";\r\n\r\n    signUpForm.querySelector(\".box-info\").innerText = \"\";\r\n    signUpForm.reset();\r\n\r\n    signUpForm.onsubmit = (evt) => {\r\n      evt.preventDefault();\r\n      let formData = new FormData(evt.target);\r\n      this.validateSignUp(formData);\r\n    };\r\n\r\n    let linkLogin = signUpForm.querySelector(\"a\");\r\n\r\n    linkLogin.onclick = (evt) => {\r\n      evt.preventDefault();\r\n      this.login();\r\n    };\r\n  };\r\n\r\n  login = () => {\r\n    this.signLoginBox.style.display = \"block\";\r\n    let signUpForm = this.signLoginBox.querySelector(\r\n      \"#entityfinderold-signup-form\"\r\n    );\r\n    let loginForm = this.signLoginBox.querySelector(\r\n      \"#entityfinderold-login-form\"\r\n    );\r\n    signUpForm.style.display = \"none\";\r\n    loginForm.style.display = \"block\";\r\n\r\n    loginForm.querySelector(\".box-info\").innerText = \"\";\r\n    loginForm.reset();\r\n\r\n    loginForm.onsubmit = (evt) => {\r\n      evt.preventDefault();\r\n      let formData = new FormData(evt.target);\r\n      this.validateLogin(formData);\r\n    };\r\n\r\n    // links\r\n\r\n    let linkSignUp = loginForm.querySelector(\"#entityfinderold-sign-link\");\r\n\r\n    linkSignUp.onclick = (evt) => {\r\n      evt.preventDefault();\r\n      this.signUp();\r\n    };\r\n\r\n    let linkResetPassword = loginForm.querySelector(\r\n      \"#entityfinderold-reset-password-link\"\r\n    );\r\n\r\n    linkResetPassword.onclick = (evt) => {\r\n      evt.preventDefault();\r\n      this.resetPasswordBox.style.display = \"block\";\r\n      this.resetPassword();\r\n    };\r\n  };\r\n\r\n  logout = () => {\r\n    this.handleLogout();\r\n    if (localStorage.getItem(\"loginUser\")) {\r\n      let token = JSON.parse(localStorage.getItem(\"loginUser\")).token;\r\n      localStorage.removeItem(\"loginUser\");\r\n      fetch(_vars_js__WEBPACK_IMPORTED_MODULE_4__.hostAddress + \"api/v1/user/logout/\", {\r\n        method: \"GET\",\r\n        headers: new Headers({\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Token ${token}`,\r\n        }),\r\n      });\r\n    }\r\n  };\r\n\r\n  resetPassword = () => {\r\n    this.resetPasswordBox.style.display = \"block\";\r\n    let resetPasswordForm = this.resetPasswordBox.querySelector(\r\n      \"#entityfinderold-reset-password-form\"\r\n    );\r\n    let resetPasswordConfirmForm = this.resetPasswordBox.querySelector(\r\n      \"#entityfinderold-reset-password-confirm-form\"\r\n    );\r\n    resetPasswordForm.onsubmit = (evt) => {\r\n      evt.preventDefault();\r\n      let formData = new FormData(evt.target);\r\n      this.resetPasswordToggle(formData);\r\n    };\r\n    resetPasswordConfirmForm.onsubmit = (evt) => {\r\n      evt.preventDefault();\r\n      let formData = new FormData(evt.target);\r\n      this.resetPasswordConfirmToggle(formData);\r\n    };\r\n  };\r\n\r\n  validateSignUp = (formData) => {\r\n    let email = formData.get(\"signEmail\").trim();\r\n    let password = formData.get(\"signPsw\").trim();\r\n    let passwordRepeat = formData.get(\"signPsw-repeat\").trim();\r\n\r\n    let signUpForm = this.signLoginBox.querySelector(\r\n      \"#entityfinderold-signup-form\"\r\n    );\r\n\r\n    let signLoginError = signUpForm.querySelector(\".box-info\");\r\n\r\n    if (passwordRepeat !== password) {\r\n      this.handleFormInfo(signLoginError, \"Passwords are not equal.\");\r\n    } else {\r\n      let postData = { email: email, password: password };\r\n      fetch(_vars_js__WEBPACK_IMPORTED_MODULE_4__.hostAddress + \"api/v1/user/register/\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(postData),\r\n        headers: new Headers({\r\n          \"Content-Type\": \"application/json\",\r\n        }),\r\n      })\r\n        .then((response) => {\r\n          if (response.ok) {\r\n            this.handleFormInfo(\r\n              signLoginError,\r\n              \"Sign Up successfully. Please login in.\",\r\n              \"green\"\r\n            );\r\n            setTimeout(() => {\r\n              this.login();\r\n              signUpForm.reset();\r\n            }, 3000);\r\n          } else {\r\n            response.json().then((text) => {\r\n              let error = Object.keys(text)[0];\r\n              this.handleFormInfo(signLoginError, text[error]);\r\n            });\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          this.handleFormInfo(signLoginError, error);\r\n        });\r\n    }\r\n  };\r\n\r\n  validateLogin = (formData) => {\r\n    let loginForm = this.signLoginBox.querySelector(\r\n      \"#entityfinderold-login-form\"\r\n    );\r\n    let signLoginError = loginForm.querySelector(\".box-info\");\r\n\r\n    let email = formData.get(\"loginEmail\").trim();\r\n    let password = formData.get(\"loginPsw\").trim();\r\n\r\n    let postData = { username: email, password: password };\r\n\r\n    fetch(_vars_js__WEBPACK_IMPORTED_MODULE_4__.hostAddress + \"api/v1/user/login/\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(postData),\r\n      headers: new Headers({\r\n        \"Content-Type\": \"application/json\",\r\n      }),\r\n    })\r\n      .then((response) => {\r\n        if (response.ok) {\r\n          response.json().then((userInfo) => {\r\n            localStorage.setItem(\"loginUser\", JSON.stringify(userInfo));\r\n            this.resetAll();\r\n            this.downloadOnto(userInfo.token, userInfo.email);\r\n            this.handleFormInfo(signLoginError, \"Login successfully.\", \"green\");\r\n            setTimeout(() => {\r\n              loginForm.reset();\r\n              this.signLoginBox.style.display = \"none\";\r\n            }, 1000);\r\n          });\r\n        } else {\r\n          response.json().then((text) => {\r\n            let error = Object.keys(text)[0];\r\n            this.handleFormInfo(signLoginError, text[error]);\r\n          });\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        this.handleFormInfo(signLoginError, error);\r\n      });\r\n  };\r\n\r\n  downloadOnto = (token, email) => {\r\n    let panelInfo = this.app.querySelector(\"#entityfinderold-sign-info\");\r\n\r\n    fetch(_vars_js__WEBPACK_IMPORTED_MODULE_4__.hostAddress + \"api/v1/ontos/lists/\", {\r\n      method: \"GET\",\r\n      headers: new Headers({\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Token ${token}`,\r\n      }),\r\n    })\r\n      .then((response) => {\r\n        if (response.ok) {\r\n          response.json().then((text) => {\r\n            text.forEach((elem) => {\r\n              let addBtn = new _onto_button__WEBPACK_IMPORTED_MODULE_2__[\"default\"](this.app, elem);\r\n              this.app\r\n                .querySelector(\"#entityfinderold-onto-extra-btn\")\r\n                .prepend(addBtn.btn);\r\n            });\r\n            panelInfo.innerText = `Current user: ${email}`;\r\n            this.isLoggedIn(true);\r\n          });\r\n        } else {\r\n          response.json().then((text) => {\r\n            panelInfo.innerText = \"Please login again\";\r\n            this.isLoggedIn(false);\r\n          });\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        panelInfo.innerText = \"Please login again\";\r\n        this.isLoggedIn(false);\r\n      });\r\n  };\r\n\r\n  resetPasswordToggle = (data) => {\r\n    let email = data.get(\"resetEmail\").trim();\r\n    var resetPasswordInfo = this.resetPasswordBox.querySelector(\r\n      \"#entityfinderold-reset-password-form .box-info\"\r\n    );\r\n\r\n    fetch(_vars_js__WEBPACK_IMPORTED_MODULE_4__.hostAddress + \"api/v1/user/reset_password/\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({ email: email }),\r\n      headers: new Headers({\r\n        \"Content-Type\": \"application/json\",\r\n      }),\r\n    })\r\n      .then((response) => {\r\n        if (response.ok) {\r\n          response.json().then((text) => {\r\n            let info = Object.keys(text)[0];\r\n            this.handleFormInfo(resetPasswordInfo, text[info], \"green\");\r\n          });\r\n        } else {\r\n          response.json().then((text) => {\r\n            let error = Object.keys(text)[0];\r\n            this.handleFormInfo(resetPasswordInfo, text[error]);\r\n          });\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        this.handleFormInfo(resetPasswordInfo, error);\r\n      });\r\n  };\r\n\r\n  resetPasswordConfirmToggle = (data) => {\r\n    let secretKey = data.get(\"secretKey\").trim();\r\n    let newPassword = data.get(\"resetPsw\").trim();\r\n    let conNewPassword = data.get(\"resetPsw-con\").trim();\r\n\r\n    let resetPasswordConfirmInfo = this.resetPasswordBox.querySelector(\r\n      \"#entityfinderold-reset-password-confirm-form .box-info\"\r\n    );\r\n\r\n    if (newPassword !== conNewPassword) {\r\n      this.handleFormInfo(resetPasswordConfirmInfo, \"Passwords are not equal!\");\r\n    } else {\r\n      fetch(_vars_js__WEBPACK_IMPORTED_MODULE_4__.hostAddress + \"api/v1/user/reset_password_confirm/\", {\r\n        method: \"PATCH\",\r\n        body: JSON.stringify({\r\n          secret_key: secretKey,\r\n          password: newPassword,\r\n        }),\r\n        headers: new Headers({\r\n          \"Content-Type\": \"application/json\",\r\n        }),\r\n      })\r\n        .then((response) => {\r\n          if (response.ok) {\r\n            response.json().then((text) => {\r\n              let info = Object.keys(text)[0];\r\n              this.handleFormInfo(\r\n                resetPasswordConfirmInfo,\r\n                text[info],\r\n                \"green\"\r\n              );\r\n              setTimeout(() => {\r\n                this.login();\r\n              }, 3000);\r\n            });\r\n          } else {\r\n            response.json().then((text) => {\r\n              let info = Object.keys(text)[0];\r\n              this.handleFormInfo(resetPasswordConfirmInfo, text[info]);\r\n            });\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          this.handleFormInfo(resetPasswordConfirmInfo, error);\r\n        });\r\n    }\r\n  };\r\n\r\n  resetAll = () => {\r\n    this.app.querySelector(\"#entityfinderold-onto-extra-btn\").innerText = \"\";\r\n    this.app.querySelector(\"#entityfinderold-sign-info\").innerText =\r\n      \"Current user:\";\r\n    _store_js__WEBPACK_IMPORTED_MODULE_1__.storeData.modifyOntoBank([], \"reset\");\r\n    _store_js__WEBPACK_IMPORTED_MODULE_1__.storeData.loadCurrentTable(null, \"reset\");\r\n  };\r\n\r\n  handleLogout = () => {\r\n    this.isLoggedIn(false);\r\n    this.resetAll();\r\n  };\r\n\r\n  isLoggedIn = (value) => {\r\n    let loginBtn = this.app.querySelector(\"#entityfinderold-login-btn\");\r\n    let logoutBtn = this.app.querySelector(\"#entityfinderold-logout-btn\");\r\n    logoutBtn.style.display = value ? \"block\" : \"none\";\r\n    loginBtn.style.display = value ? \"none\" : \"block\";\r\n  };\r\n\r\n  handleFormInfo = (elem, input, color = \"red\") => {\r\n    elem.style.color = color;\r\n    elem.textContent = input;\r\n  };\r\n}\r\n\r\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SignForm);\r\n\n\n//# sourceURL=webpack://drawio_test/./ontopanelSource/entityFinder_version1/scripts/login-system.js?");

/***/ })

},
/******/ function(__webpack_require__) { // webpackRuntimeModules
/******/ /* webpack/runtime/getFullHash */
/******/ (() => {
/******/ 	__webpack_require__.h = () => ("e88d96dd0ed7b018f293")
/******/ })();
/******/ 
/******/ }
);